<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ch√° de Cozinha - Lista de Presentes</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Dancing+Script:wght@700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .font-dancing {
            font-family: 'Dancing Script', cursive;
        }
    </style>
</head>
<body class="bg-pink-50 text-gray-800">

    <!-- Container Principal -->
    <div class="container mx-auto p-4 md:p-8 max-w-4xl">

        <!-- Cabe√ßalho -->
        <header class="text-center mb-8 md:mb-12">
            <h1 class="font-dancing text-5xl md:text-7xl text-pink-500">Nosso Ch√° de Cozinha</h1>
            <p class="text-gray-500 mt-2 text-lg">Seu presente ajuda a construir nosso lar!</p>
        </header>

        <!-- Se√ß√£o de Identifica√ß√£o do Convidado (Inicialmente vis√≠vel) -->
        <section id="guest-login" class="bg-white p-8 rounded-xl shadow-md max-w-md mx-auto">
            <h2 class="text-2xl font-bold mb-4 text-center text-gray-700">Seja bem-vindo(a)!</h2>
            <p class="text-center mb-6 text-gray-600">Para continuar e ver a lista de presentes, por favor, digite seu nome e sobrenome.</p>
            <div class="space-y-4">
                <input type="text" id="guest-name" placeholder="Seu nome e sobrenome" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-400 transition">
                <button id="start-button" class="w-full bg-pink-500 text-white font-bold py-3 px-4 rounded-lg hover:bg-pink-600 transition-all duration-300 transform hover:scale-105">Ver Lista de Presentes</button>
            </div>
            <p id="name-error" class="text-red-500 text-sm mt-2 text-center hidden">Por favor, preencha seu nome.</p>
        </section>

        <!-- Se√ß√£o da Lista de Presentes (Inicialmente oculta) -->
        <section id="gift-section" class="hidden">
             <div class="text-center mb-8">
                <p class="text-xl">Ol√°, <strong id="welcome-guest-name" class="text-pink-600"></strong>!</p>
                <p class="text-gray-600">Escolha um item abaixo com carinho. Agradecemos sua contribui√ß√£o!</p>
            </div>
            <div id="gift-list" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Cards de presentes ser√£o inseridos aqui pelo JavaScript -->
                 <div class="text-center p-8 col-span-full">
                    <p class="text-gray-500">Carregando lista de presentes...</p>
                </div>
            </div>
        </section>

    </div>
    
    <!-- Modal de Confirma√ß√£o -->
    <div id="confirmation-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white rounded-lg p-8 shadow-2xl max-w-sm w-full text-center transform transition-all scale-95">
            <h3 class="text-xl font-bold mb-4">Confirmar Escolha?</h3>
            <p class="mb-6">Voc√™ est√° prestes a escolher <strong id="modal-item-name" class="text-pink-600"></strong>. Este item ser√° marcado em seu nome.</p>
            <div class="flex justify-center gap-4">
                <button id="cancel-button" class="px-6 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition">Cancelar</button>
                <button id="confirm-button" class="px-6 py-2 bg-pink-500 text-white font-bold rounded-lg hover:bg-pink-600 transition">Confirmar</button>
            </div>
        </div>
    </div>


    <!-- Script do Firebase e L√≥gica da Aplica√ß√£o -->
    <script type="module">
        // Importa√ß√µes do Firebase
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, collection, onSnapshot, doc, updateDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

        // ************************************************************************************
        // COLE A CONFIGURA√á√ÉO DO SEU FIREBASE AQUI
        // Siga o passo a passo no arquivo INSTRUCOES.md para obter este c√≥digo.
        // ************************************************************************************
        const firebaseConfig = {
           apiKey: "AIzaSyAvI2t9dXajuZClHUImty038scK4xwfiZs",
           authDomain: "cha-de-cozinha-626ad.firebaseapp.com",
           projectId: "cha-de-cozinha-626ad",
           storageBucket: "cha-de-cozinha-626ad.firebasestorage.app",
           messagingSenderId: "424924149259",
           appId: "1:424924149259:web:c1cef51b6bc0dd5653790e"
        };
        // ************************************************************************************

        // ####################################################################################
        // ##                                                                                ##
        // ##  --> SUA LISTA DE PRESENTES <--                                                ##
        // ##  Modifique, adicione ou remova os itens abaixo como desejar.                   ##
        // ##  O √≠cone √© um emoji e √© opcional.                                              ##
        // ##                                                                                ##
        // ####################################################################################
        const initialGiftList = [
            { name: 'Jogo de Panelas Antiaderente', icon: 'üç≥' },
            { name: 'Aparelho de Jantar 20 pe√ßas', icon: 'üçΩÔ∏è' },
            { name: 'Faqueiro Completo Inox', icon: 'üç¥' },
            { name: 'Liquidificador Turbo', icon: 'ü•§' },
            { name: 'Batedeira Planet√°ria', icon: 'üç∞' },
            { name: 'Fritadeira El√©trica (Air Fryer)', icon: 'üçü' },
            { name: 'Cafeteira Expresso', icon: '‚òï' },
            { name: 'Jogo de Ta√ßas de Cristal', icon: 'üç∑' },
            { name: 'Jogo de Toalhas de Banho', icon: 'üõÄ' },
            { name: 'Edredom Queen Size', icon: 'üõå' },
            { name: 'Aspirador de P√≥ Vertical', icon: 'üßπ' },
            { name: 'Kit de Potes de Vidro', icon: 'ü´ô' },
            { name: 'Chaleira El√©trica', icon: 'üí®' },
            { name: 'Sanduicheira e Grill', icon: 'ü•™' },
            { name: 'Escorredor de Lou√ßa Inox', icon: 'üíß' },
        ];
        // ####################################################################################

        // Inicializa√ß√£o do Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        // Elementos da p√°gina
        const guestLoginSection = document.getElementById('guest-login');
        const giftSection = document.getElementById('gift-section');
        const guestNameInput = document.getElementById('guest-name');
        const startButton = document.getElementById('start-button');
        const nameError = document.getElementById('name-error');
        const giftListContainer = document.getElementById('gift-list');
        const welcomeGuestName = document.getElementById('welcome-guest-name');
        
        // Elementos do Modal
        const modal = document.getElementById('confirmation-modal');
        const modalItemName = document.getElementById('modal-item-name');
        const confirmButton = document.getElementById('confirm-button');
        const cancelButton = document.getElementById('cancel-button');
        
        let guestName = '';

        // Tenta autenticar o usu√°rio anonimamente para seguran√ßa
        signInAnonymously(auth).catch((error) => {
            console.error("Erro na autentica√ß√£o an√¥nima:", error);
            giftListContainer.innerHTML = `<p class="text-red-500 col-span-full text-center">Erro de autentica√ß√£o. Por favor, recarregue a p√°gina.</p>`;
        });


        // Fun√ß√£o para renderizar a lista de presentes
        const renderGifts = (gifts) => {
            giftListContainer.innerHTML = ''; // Limpa a lista antes de renderizar

            if (!gifts.length) {
                 giftListContainer.innerHTML = `<p class="text-gray-500 col-span-full text-center">A lista de presentes ainda n√£o foi cadastrada. Volte mais tarde!</p>`;
                 return;
            }
            
            gifts.forEach(gift => {
                const isChosen = gift.chosen;
                const card = document.createElement('div');
                card.className = `bg-white rounded-xl shadow-md p-5 flex flex-col items-center text-center transition-all duration-300 ${isChosen ? 'opacity-50 grayscale' : 'hover:shadow-lg hover:transform hover:-translate-y-1'}`;

                card.innerHTML = `
                    <div class="text-6xl mb-4">${gift.icon || 'üéÅ'}</div>
                    <h3 class="font-bold text-lg text-gray-800 mb-2">${gift.name}</h3>
                    <p class="text-gray-500 text-sm mb-4 flex-grow">${isChosen ? `Escolhido por: <strong>${gift.chosenBy}</strong>` : 'Dispon√≠vel'}</p>
                    <button 
                        data-id="${gift.id}" 
                        data-name="${gift.name}"
                        class="w-full mt-auto text-white font-bold py-2 px-4 rounded-lg transition-colors duration-300 ${isChosen ? 'bg-gray-400 cursor-not-allowed' : 'bg-pink-500 hover:bg-pink-600'}"
                        ${isChosen ? 'disabled' : ''}
                    >
                        ${isChosen ? 'Indispon√≠vel' : 'Escolher Presente'}
                    </button>
                `;
                giftListContainer.appendChild(card);
            });

            // Adiciona evento de clique aos bot√µes "Escolher Presente"
            document.querySelectorAll('button[data-id]').forEach(button => {
                if (!button.disabled) {
                    button.addEventListener('click', (e) => {
                        const giftId = e.target.getAttribute('data-id');
                        const giftName = e.target.getAttribute('data-name');
                        showConfirmationModal(giftId, giftName);
                    });
                }
            });
        };

        // Fun√ß√£o para mostrar o modal de confirma√ß√£o
        const showConfirmationModal = (giftId, giftName) => {
            modalItemName.textContent = giftName;
            modal.classList.remove('hidden');
            
            // Usamos .cloneNode e .replaceWith para remover listeners antigos e evitar cliques m√∫ltiplos
            const newConfirmButton = confirmButton.cloneNode(true);
            confirmButton.parentNode.replaceChild(newConfirmButton, confirmButton);
            
            newConfirmButton.addEventListener('click', () => handleGiftSelection(giftId));

            document.body.style.overflow = 'hidden'; // Evita scroll da p√°gina
        };

        // Fun√ß√£o para esconder o modal
        const hideConfirmationModal = () => {
            modal.classList.add('hidden');
            document.body.style.overflow = 'auto';
        };
        
        cancelButton.addEventListener('click', hideConfirmationModal);
        modal.addEventListener('click', (e) => {
            if (e.target === modal) {
                hideConfirmationModal();
            }
        });


        // Fun√ß√£o para lidar com a sele√ß√£o de um presente
        const handleGiftSelection = async (giftId) => {
            if (!guestName) {
                alert('Ocorreu um erro. Por favor, tente novamente.');
                return;
            }
            try {
                const giftRef = doc(db, "gifts", giftId);
                await updateDoc(giftRef, {
                    chosen: true,
                    chosenBy: guestName
                });
                hideConfirmationModal();
            } catch (error) {
                console.error("Erro ao escolher o presente: ", error);
                alert("Ocorreu um erro ao salvar sua escolha. Tente novamente.");
            }
        };

        // Escuta por mudan√ßas na cole√ß√£o 'gifts' em tempo real
        const listenForGifts = () => {
            onSnapshot(collection(db, "gifts"), (snapshot) => {
                const gifts = [];
                snapshot.forEach((doc) => {
                    gifts.push({ id: doc.id, ...doc.data() });
                });
                // Ordena para que os dispon√≠veis apare√ßam primeiro
                gifts.sort((a, b) => a.chosen - b.chosen);
                renderGifts(gifts);
            }, (error) => {
                console.error("Erro ao buscar presentes: ", error);
                giftListContainer.innerHTML = `<p class="text-red-500 col-span-full text-center">N√£o foi poss√≠vel carregar a lista. Verifique sua conex√£o ou a configura√ß√£o do Firebase.</p>`;
            });
        }
        
        // L√≥gica de Login do Convidado
        const login = () => {
             const name = guestNameInput.value.trim();
            if (name) {
                guestName = name;
                sessionStorage.setItem('guestName', guestName); // Salva o nome na sess√£o
                
                guestLoginSection.classList.add('hidden');
                giftSection.classList.remove('hidden');
                welcomeGuestName.textContent = guestName;
                listenForGifts(); // Come√ßa a ouvir os presentes s√≥ depois do login
            } else {
                nameError.classList.remove('hidden');
            }
        }

        startButton.addEventListener('click', login);
        guestNameInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                login();
            }
        });
        
        guestNameInput.addEventListener('input', () => {
             nameError.classList.add('hidden');
        });

        // Verifica se o nome j√° est√° salvo na sess√£o ao carregar a p√°gina
        window.addEventListener('load', () => {
            const savedName = sessionStorage.getItem('guestName');
            if (savedName) {
                guestName = savedName;
                guestLoginSection.classList.add('hidden');
                giftSection.classList.remove('hidden');
                welcomeGuestName.textContent = guestName;
                listenForGifts();
            }
        });

    </script>
</body>
</html>
