<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ch√° de casa nova - Bya e Ranny</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Dancing+Script:wght@700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .font-dancing {
            font-family: 'Dancing Script', cursive;
        }
    </style>
</head>
<body class="bg-amber-50 text-gray-800">

    <!-- Container Principal -->
    <div class="container mx-auto p-4 md:p-8 max-w-4xl">

        <!-- Cabe√ßalho -->
        <header class="text-center mb-8 md:mb-12">
            <h1 class="font-dancing text-5xl md:text-7xl text-amber-800">Nosso Ch√° de Casa Nova</h1>
            <p class="text-gray-500 mt-2 text-lg">Bya & Ranny</p>
        </header>

        <!-- Se√ß√£o de Identifica√ß√£o do Convidado (Inicialmente vis√≠vel) -->
        <section id="guest-login" class="bg-white p-8 rounded-xl shadow-md max-w-md mx-auto">
            <h2 class="text-2xl font-bold mb-4 text-center text-gray-700">Seja bem-vindo(a)!</h2>
            
            <!-- Mensagem dos noivos -->
            <div class="bg-amber-50/60 p-4 rounded-lg text-gray-700 text-sm text-left mb-6 border border-amber-100">
                <p class="mb-3">A casa √© nova, a vida √© nova e a gente quer celebrar essa nova fase incr√≠vel da nossa vida com as pessoas mais especiais: VOC√äS! Para nos ajudar a montar o ap√™ dos sonhos (e evitar presentes repetidos!), criamos essa listinha especial.</p>
                <p class="mb-2 font-semibold">As cores da decora√ß√£o do nosso ap√™ s√£o:</p>
                <ul class="list-disc list-inside mb-4 text-gray-600">
                    <li>Preto, cinza, branco e madeira.</li>
                </ul>
                <p>Qualquer d√∫vida, os noivos est√£o √† disposi√ß√£o! üëç</p>
            </div>

            <p class="text-center mb-6 text-gray-600">Para continuar e ver a lista, digite seu nome:</p>
            <div class="space-y-4">
                <input type="text" id="guest-name" placeholder="Seu nome e sobrenome" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500 transition">
                <button id="start-button" class="w-full bg-amber-700 text-white font-bold py-3 px-4 rounded-lg hover:bg-amber-800 transition-all duration-300 transform hover:scale-105">Ver Lista de Presentes</button>
            </div>
            <p id="name-error" class="text-red-500 text-sm mt-2 text-center hidden">Por favor, preencha seu nome.</p>
        </section>

        <!-- Se√ß√£o da Lista de Presentes (Inicialmente oculta) -->
        <section id="gift-section" class="hidden">
             <div class="text-center mb-8">
                <p class="text-xl">Ol√°, <strong id="welcome-guest-name" class="text-amber-900"></strong>!</p>
                <p class="text-gray-600">Escolha um item abaixo com carinho. Agradecemos sua contribui√ß√£o!</p>
            </div>
            <div id="gift-list" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Cards de presentes ser√£o inseridos aqui pelo JavaScript -->
                 <div class="text-center p-8 col-span-full">
                    <p class="text-gray-500">Carregando lista de presentes...</p>
                </div>
            </div>
        </section>

    </div>
    
    <!-- Modal de Confirma√ß√£o -->
    <div id="confirmation-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white rounded-lg p-8 shadow-2xl max-w-sm w-full text-center transform transition-all scale-95">
            <h3 class="text-xl font-bold mb-4">Confirmar Escolha?</h3>
            <p class="mb-6">Voc√™ est√° prestes a escolher <strong id="modal-item-name" class="text-amber-900"></strong>. Este item ser√° marcado em seu nome.</p>
            <div class="flex justify-center gap-4">
                <button id="cancel-button" class="px-6 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition">Cancelar</button>
                <button id="confirm-button" class="px-6 py-2 bg-amber-700 text-white font-bold rounded-lg hover:bg-amber-800 transition">Confirmar</button>
            </div>
        </div>
    </div>


    <!-- Script do Firebase e L√≥gica da Aplica√ß√£o -->
    <script type="module">
        // Importa√ß√µes do Firebase
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, collection, onSnapshot, doc, updateDoc, getDocs, addDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

        // ************************************************************************************
        // COLE A CONFIGURA√á√ÉO DO SEU FIREBASE AQUI
        // ************************************************************************************
        const firebaseConfig = {
            apiKey: "AIzaSyAvI2t9dXajuZClHUImty038scK4xwfiZs",
            authDomain: "cha-de-cozinha-626ad.firebaseapp.com",
            projectId: "cha-de-cozinha-626ad",
            storageBucket: "cha-de-cozinha-626ad.appspot.com",
            messagingSenderId: "424924149259",
            appId: "1:424924149259:web:c1cef51b6bc0dd5653790e"
        };
        // ************************************************************************************

        // ####################################################################################
        // ##                                                                                ##
        // ##  --> SUA LISTA DE PRESENTES <--                                                ##
        // ##  Adicione a propriedade 'quantity' para definir quantas vezes um item          ##
        // ##  pode ser escolhido. Se n√£o for definida, ser√° 1.                              ##
        // ##                                                                                ##
        // ####################################################################################
        const initialGiftList = [
            { name: 'Abridor de latas', icon: 'ü•´', link: 'https://s.shopee.com.br/9UpsV32XgH', quantity: 1 },
            { name: 'Abridor de potes', icon: 'ü´ô', link: 'https://s.shopee.com.br/AA7ftpI0V0', quantity: 1 },
            { name: 'Airfrier', icon: 'üçü', link: 'https://s.shopee.com.br/2B5ODNMGY9', quantity: 1 },
            { name: 'Almofada', icon: 'üõãÔ∏è', link: 'https://s.shopee.com.br/6KuxMEPFFC', quantity: 1 },
            { name: 'Amassador de batata', icon: 'ü•î', link: 'https://s.shopee.com.br/9zoFgmztN9', quantity: 1 },
            { name: 'Aparelho de jantar (18 pe√ßas)', icon: 'üçΩÔ∏è', link: 'https://s.shopee.com.br/6KuxBLKnPX', quantity: 2 },
            { name: 'Balde', icon: 'ü™£', link: 'https://s.shopee.com.br/4L9t5PbEqp', quantity: 2 },
            { name: 'Batedeira', icon: 'üç∞', link: 'https://s.shopee.com.br/9pUpLu8ZUB', quantity: 1 },
            { name: 'Boleira', icon: 'üéÇ', link: 'https://s.shopee.com.br/3qDcLvbz1B', quantity: 1 },
            { name: 'Cafeteira', icon: '‚òï', link: 'https://s.shopee.com.br/3ValoQbRR0', quantity: 1 },
            { name: 'Caneca/Leiteira', icon: 'ü•õ', link: 'https://s.shopee.com.br/5L2Q7UIEj2', quantity: 1 },
            { name: 'Capa para almofadas', icon: 'üñºÔ∏è', link: 'https://s.shopee.com.br/8URz8R9q3k', quantity: 2 },
            { name: 'Chaleira el√©trica', icon: 'üí®', link: 'https://s.shopee.com.br/3ValvmBdCr', quantity: 1 },
            { name: 'Coberdrom', icon: 'üõå', link: 'https://s.shopee.com.br/6fXnkMnIGs', quantity: 2 },
            { name: 'Copo de medida', icon: 'üìè', link: 'https://s.shopee.com.br/8fIrzbJpP4', quantity: 1 },
            { name: 'Edredom', icon: 'üõå', link: 'https://s.shopee.com.br/4fmjMJlI6I', quantity: 2 },
            { name: 'Escorredor de lou√ßas', icon: 'üíß', link: 'https://s.shopee.com.br/5L2Q6UcoSm', quantity: 1 },
            { name: 'Escorredor de macarr√£o', icon: 'üçù', link: 'https://s.shopee.com.br/8UzRnrNViG', quantity: 1 },
            { name: 'Espremedor de laranja', icon: 'üçä', link: 'https://s.shopee.com.br/6KuxE8q6fy', quantity: 1 },
            { name: 'Ferro de passar', icon: 'üëî', link: 'https://s.shopee.com.br/LdkK9S2n6', quantity: 1 },
            { name: 'Garrafa de caf√©', icon: '‚òï', link: 'https://s.shopee.com.br/AKR60Tgy3I', quantity: 1 },
            { name: 'Jarra de suco', icon: 'üçπ', link: 'https://s.shopee.com.br/5AizrPyWsY', quantity: 1 },
            { name: 'Jogo americano (op√ß√£o 1)', icon: 'üçΩÔ∏è', link: 'https://s.shopee.com.br/2g1enQFqWo', quantity: 1 },
            { name: 'Jogo americano (op√ß√£o 2)', icon: 'üçΩÔ∏è', link: 'https://s.shopee.com.br/3AxvibCU1V', quantity: 1 },
            { name: 'Jogo de cama', icon: 'üõå', link: 'https://s.shopee.com.br/2g1eyITZDu', quantity: 3 },
            { name: 'Jogo de copos', icon: 'ü•õ', link: 'https://s.shopee.com.br/9pUpNty4yI', quantity: 2 },
            { name: 'Jogo de copos (12 un)', icon: 'ü•õ', link: 'https://s.shopee.com.br/9pUPNty4yI', quantity: 2 },
            { name: 'Jogo de peneira', icon: 'ü•£', link: 'https://s.shopee.com.br/4fmjKSXWfa', quantity: 1 },
            { name: 'Jogo de ta√ßas', icon: 'üç∑', link: 'https://s.shopee.com.br/3LHLeAQN9f', quantity: 2 },
            { name: 'Jogo de talher', icon: 'üç¥', link: 'https://s.shopee.com.br/30eVE11RVi', quantity: 2 },
            { name: 'Kit Bar', icon: 'üç∏', link: 'https://s.shopee.com.br/2ViEuztVwe', quantity: 1 },
            { name: 'Kit Banheiro', icon: 'üöΩ', link: 'https://s.shopee.com.br/8UzS2RWjMK', quantity: 1 },
            { name: 'Kit Churrasco', icon: 'üçñ', link: 'https://s.shopee.com.br/803BSwpoa2', quantity: 1 },
            { name: 'Kit Cozinha', icon: 'ü•Ñ', link: 'https://s.shopee.com.br/40X2OTzkcr', quantity: 1 },
            { name: 'Kit Formas', icon: 'üç∞', link: 'https://s.shopee.com.br/9pUPPfQcBE', quantity: 1 },
            { name: 'Kit lavanderia/dispenser', icon: 'üßº', link: 'https://s.shopee.com.br/6VENfeDjBM', quantity: 1 },
            { name: 'Kit Marinex', icon: 'ü•£', link: 'https://s.shopee.com.br/50PZgLlevr', quantity: 1 },
            { name: 'Liquidificador', icon: 'ü•§', link: 'https://s.shopee.com.br/7pjI2X0nHK', quantity: 1 },
            { name: 'Manta', icon: 'üß£', link: 'https://s.shopee.com.br/803BL2L24E', quantity: 2 },
            { name: 'Manta para sof√°', icon: 'üß£', link: 'https://s.shopee.com.br/8zviX0Miyl', quantity: 1 },
            { name: 'Martelo de carne', icon: 'üî®', link: 'https://s.shopee.com.br/7KnUVIDH8e', quantity: 1 },
            { name: 'Panela de press√£o', icon: 'üç≥', link: 'https://s.shopee.com.br/2LOoVNX64A', quantity: 1 },
            { name: 'Panela de press√£o el√©trica', icon: 'üç≥', link: 'https://s.shopee.com.br/4q69TkTEcG', quantity: 1 },
            { name: 'Pipoqueira', icon: 'üçø', link: 'https://s.shopee.com.br/8fIs5THyvs', quantity: 1 },
            { name: 'Porta Frios (4 un)', icon: 'üßÄ', link: 'https://s.shopee.com.br/6fXngSoK8P', quantity: 1 },
            { name: 'Pote herm√©tico', icon: 'ü´ô', link: 'https://s.shopee.com.br/40X2XXNzOV', quantity: 2 },
            { name: 'Processador/mixer', icon: 'üî™', link: 'https://s.shopee.com.br/3fuC7tKFD3', quantity: 1 },
            { name: 'Ta√ßa de sobremesa', icon: 'üç®', link: 'https://s.shopee.com.br/5AizsrX2g8', quantity: 2 },
            { name: 'Tampa de microondas', icon: '‚öôÔ∏è', link: 'https://s.shopee.com.br/9fBPIzy5dN', quantity: 1 },
            { name: 'Tapete', icon: 'üö™', link: 'https://s.shopee.com.br/1g97u2fVQv', quantity: 2 },
            { name: 'Toalha de banho', icon: 'üõÅ', link: 'https://s.shopee.com.br/4fmjRtwQLT', quantity: 4 },
            { name: 'Toalha de mesa', icon: '‚ú®', link: 'https://s.shopee.com.br/2ViEaytJXK', quantity: 2 },
            { name: 'Toalha de rosto', icon: 'üßº', link: 'https://s.shopee.com.br/803BQGDLU0', quantity: 4 },
            { name: 'Vaso de flor', icon: 'üíê', link: 'https://s.shopee.com.br/803B9MwJ4Z', quantity: 1 },
        ];
        // ####################################################################################

        // Inicializa√ß√£o do Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        // Elementos da p√°gina
        const guestLoginSection = document.getElementById('guest-login');
        const giftSection = document.getElementById('gift-section');
        const guestNameInput = document.getElementById('guest-name');
        const startButton = document.getElementById('start-button');
        const nameError = document.getElementById('name-error');
        const giftListContainer = document.getElementById('gift-list');
        const welcomeGuestName = document.getElementById('welcome-guest-name');
        
        // Elementos do Modal
        const modal = document.getElementById('confirmation-modal');
        const modalItemName = document.getElementById('modal-item-name');
        const cancelButton = document.getElementById('cancel-button');
        
        let guestName = '';
        let localGiftsData = []; 

        // Fun√ß√£o para popular a lista de presentes no Firebase (apenas se estiver vazia)
        const initializeGiftListIfNeeded = async () => {
            const giftsCollection = collection(db, "gifts");
            try {
                const snapshot = await getDocs(giftsCollection);
                
                if (snapshot.empty) {
                    console.log("Cole√ß√£o 'gifts' est√° vazia. Populando com a lista inicial...");
                    const promises = initialGiftList.map(gift => {
                        return addDoc(giftsCollection, {
                            name: gift.name,
                            icon: gift.icon || 'üéÅ',
                            quantity: gift.quantity || 1, // Salva a quantidade
                            chosenCount: 0, // Contador de quantas vezes foi escolhido
                            chosenBy: [] // Array com nomes de quem escolheu
                        });
                    });
                    await Promise.all(promises);
                    console.log("Lista de presentes inicializada no Firebase!");
                } else {
                    console.log("Cole√ß√£o 'gifts' j√° cont√©m dados.");
                }
            } catch (error) {
                console.error("Erro ao inicializar a lista de presentes: ", error);
            }
        };

        // Autentica o usu√°rio e inicializa a lista de presentes
        signInAnonymously(auth)
            .then(() => {
                console.log("Autenticado anonimamente com sucesso.");
                initializeGiftListIfNeeded();
            })
            .catch((error) => {
                console.error("Erro na autentica√ß√£o an√¥nima:", error);
                giftListContainer.innerHTML = `<p class="text-red-500 col-span-full text-center">Erro de autentica√ß√£o. Por favor, recarregue a p√°gina.</p>`;
            });


        // Fun√ß√£o para renderizar a lista de presentes
        const renderGifts = (giftsFromFirebase) => {
            giftListContainer.innerHTML = ''; 

            if (!giftsFromFirebase.length) {
                 giftListContainer.innerHTML = `<p class="text-gray-500 col-span-full text-center">A lista de presentes ainda n√£o foi cadastrada. Volte mais tarde!</p>`;
                 return;
            }
            
            localGiftsData = giftsFromFirebase.map(dbGift => {
                const localGift = initialGiftList.find(lg => lg.name === dbGift.name);
                return { ...dbGift, link: localGift ? localGift.link : null };
            });

            localGiftsData.forEach(gift => {
                const isFullyChosen = gift.chosenCount >= gift.quantity;
                const availableCount = gift.quantity - gift.chosenCount;
                const card = document.createElement('div');
                card.className = `bg-white rounded-xl shadow-md p-5 flex flex-col items-center text-center transition-all duration-300 ${isFullyChosen ? 'opacity-50 grayscale' : 'hover:shadow-lg hover:transform hover:-translate-y-1'}`;

                card.innerHTML = `
                    <div class="text-6xl mb-4">${gift.icon || 'üéÅ'}</div>
                    <h3 class="font-bold text-lg text-gray-800 mb-2 flex-grow">${gift.name}</h3>
                    <p class="font-semibold text-sm my-4 ${isFullyChosen ? 'text-red-500' : 'text-green-600'}">
                        ${isFullyChosen ? 'Indispon√≠vel' : `Dispon√≠vel (${availableCount} de ${gift.quantity})`}
                    </p>
                    
                    <div class="w-full mt-auto pt-4 border-t border-gray-100 space-y-2">
                        ${gift.link ? `<a href="${gift.link}" target="_blank" rel="noopener noreferrer" class="block w-full bg-white border border-amber-700 text-amber-700 font-bold py-2 px-4 rounded-lg hover:bg-amber-50 transition-colors duration-300">Ver produto</a>` : ''}
                        
                        <button 
                            data-id="${gift.id}" 
                            data-name="${gift.name}"
                            class="w-full text-white font-bold py-2 px-4 rounded-lg transition-colors duration-300 ${isFullyChosen ? 'bg-gray-400 cursor-not-allowed' : 'bg-amber-700 hover:bg-amber-800'}"
                            ${isFullyChosen ? 'disabled' : ''}
                        >
                            ${isFullyChosen ? 'Indispon√≠vel' : 'Escolher Presente'}
                        </button>
                    </div>
                `;
                giftListContainer.appendChild(card);
            });

            document.querySelectorAll('button[data-id]').forEach(button => {
                if (!button.disabled) {
                    button.addEventListener('click', (e) => {
                        const giftId = e.target.getAttribute('data-id');
                        const giftName = e.target.getAttribute('data-name');
                        showConfirmationModal(giftId, giftName);
                    });
                }
            });
        };

        const showConfirmationModal = (giftId, giftName) => {
            modalItemName.textContent = giftName;
            modal.classList.remove('hidden');
            
            let currentConfirmButton = document.getElementById('confirm-button');
            const newConfirmButton = currentConfirmButton.cloneNode(true);
            currentConfirmButton.parentNode.replaceChild(newConfirmButton, currentConfirmButton);
            
            newConfirmButton.addEventListener('click', () => handleGiftSelection(giftId));

            document.body.style.overflow = 'hidden';
        };

        const hideConfirmationModal = () => {
            modal.classList.add('hidden');
            document.body.style.overflow = 'auto';
        };
        
        cancelButton.addEventListener('click', hideConfirmationModal);
        modal.addEventListener('click', (e) => {
            if (e.target === modal) {
                hideConfirmationModal();
            }
        });

        // Fun√ß√£o para lidar com a sele√ß√£o de um presente
        const handleGiftSelection = async (giftId) => {
            if (!guestName) {
                alert('Ocorreu um erro. Por favor, tente novamente.');
                return;
            }
            try {
                const currentGift = localGiftsData.find(g => g.id === giftId);
                if (!currentGift || currentGift.chosenCount >= currentGift.quantity) {
                    alert("Ops! Parece que este item n√£o est√° mais dispon√≠vel. A lista foi atualizada.");
                    hideConfirmationModal();
                    return;
                }

                const giftRef = doc(db, "gifts", giftId);
                
                const updatedChosenBy = [...currentGift.chosenBy, guestName];
                const newChosenCount = currentGift.chosenCount + 1;

                await updateDoc(giftRef, {
                    chosenCount: newChosenCount,
                    chosenBy: updatedChosenBy
                });
                hideConfirmationModal();
            } catch (error) {
                console.error("Erro ao escolher o presente: ", error);
                alert("Ocorreu um erro ao salvar sua escolha. Tente novamente.");
            }
        };

        // Escuta por mudan√ßas na cole√ß√£o 'gifts' em tempo real
        const listenForGifts = () => {
            onSnapshot(collection(db, "gifts"), (snapshot) => {
                const gifts = [];
                snapshot.forEach((doc) => {
                    gifts.push({ id: doc.id, ...doc.data() });
                });
                // Ordena para que itens indispon√≠veis fiquem no final
                gifts.sort((a, b) => (a.chosenCount >= a.quantity) - (b.chosenCount >= b.quantity));
                renderGifts(gifts);
            }, (error) => {
                console.error("Erro ao buscar presentes: ", error);
                giftListContainer.innerHTML = `<p class="text-red-500 col-span-full text-center">N√£o foi poss√≠vel carregar a lista. Verifique sua conex√£o ou a configura√ß√£o do Firebase.</p>`;
            });
        }
        
        const login = () => {
             const name = guestNameInput.value.trim();
            if (name) {
                guestName = name;
                sessionStorage.setItem('guestName', guestName);
                
                guestLoginSection.classList.add('hidden');
                giftSection.classList.remove('hidden');
                welcomeGuestName.textContent = guestName;
                listenForGifts();
            } else {
                nameError.classList.remove('hidden');
            }
        }

        startButton.addEventListener('click', login);
        guestNameInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                login();
            }
        });
        
        guestNameInput.addEventListener('input', () => {
             nameError.classList.add('hidden');
        });

        window.addEventListener('load', () => {
            const savedName = sessionStorage.getItem('guestName');
            if (savedName) {
                guestName = savedName;
                guestLoginSection.classList.add('hidden');
                giftSection.classList.remove('hidden');
                welcomeGuestName.textContent = guestName;
                listenForGifts();
            }
        });

    </script>
</body>
</html>
